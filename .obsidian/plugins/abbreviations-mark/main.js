/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var rt=Object.defineProperty;var Wt=Object.getOwnPropertyDescriptor;var Vt=Object.getOwnPropertyNames;var Rt=Object.prototype.hasOwnProperty;var q=(a,e)=>{for(var t in e)rt(a,t,{get:e[t],enumerable:!0})},Ht=(a,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Vt(e))!Rt.call(a,n)&&n!==t&&rt(a,n,{get:()=>e[n],enumerable:!(i=Wt(e,n))||i.enumerable});return a};var Gt=a=>Ht(rt({},"__esModule",{value:!0}),a);var Te={};q(Te,{default:()=>Me});module.exports=Gt(Te);var y=require("obsidian"),$t=require("@codemirror/view");var lt={};q(lt,{button:()=>qt,command:()=>jt,default:()=>Zt,input:()=>zt,list:()=>_t,manager:()=>Qt,menu:()=>Xt,notification:()=>Ut,setting:()=>Yt,text:()=>Jt});var qt={delete:"Delete",submit:"Submit",add:"Add",back:"Back"},Jt={abbrLabel:"Abbreviation:",abbrPlaceholder:"Short form",tipPlaceholder:"Full form"},jt={add:"Add abbreviation",copy:"Copy and format content",insert:"Insert extra definition",list:"List abbreviations",manage:"Manage global abbreviations"},Ut={copied:"Content has been copied!",copyWarn:"Warn: The copied content is empty!",copyError:"Error: Unable to copy content!",metadataAdded:"Added metadata abbreviation: {abbr}.",metadataDeleted:"Deleted metadata abbreviation: {abbr}.",metadataError:"Error: Metadata keyword is empty!",globalAdded:"Added global abbreviation: {abbr}.",globalDeleted:"Deleted global abbreviation: {abbr}.",formatWarn:"Warn: Abbreviation format is incorrect!",notFoundWarn:"Warn: No original abbreviation found!",unexpectedError:"Error: Unexpected error!",fileError:"Error: No active file found!",fileNotExistError:"Error: The file does not exist!"},zt={editTitle:"Edit {type} abbreviation",addTitle:"Add metadata abbreviation"},_t={empty:"No abbreviations found.",placeholder:"Type the search term",global:"Global",globalTip:"Add it to global abbreviations",type:"type: {type}",position:" - position: {position}"},Qt={title:"Manage global abbreviations",addTip:"Add new abbreviation"},Xt={type:"Type: {type}",text:"Text: {text}",tooltip:"Tooltip: {tooltip}",line:"Line: {line}",edit:"Edit abbreviation",add:"Add to global abbreviations",copyText:"Copy abbreviation text",copyTooltip:"Copy abbreviation tooltip",copyMetadata:"Copy metadata format definition",copyExtra:"Copy extra format definition",copyHtml:"Copy HTML format definition"},Yt={metadataKeyword:"Metadata keyword",metadataKeywordDesc:"The key name that reads the abbreviation information from the {placeholder}.",metadataKeywordPlaceholder:"Enter the keyword",properties:"properties",markInSourceMode:"Mark abbreviations in Source mode",markInSourceModeDesc:"In Source mode, mark abbreviations just like in Live Preview and Reading view.",detectCJK:"Enable abbreviation detection for languages not separated by spaces",detectCJKDesc:"Detect abbreviations in languages that do not use spaces for word segmentation, such as {placeholder}.",globalAbbreviations:"Global abbreviations",globalAbbreviationsButton:"Manage abbreviations",globalAbbreviationsDesc:"Configure global abbreviations, but their priority is lower than {placeholder}.",extraHeading:"Markdown Extra syntax",useMarkdownExtraSyntax:"Enable Markdown Extra syntax support",useMarkdownExtraSyntaxDesc:"Toggle this setting to enable or disable the feature. Definition format: {placeholder}.",useExtraDefinitionDecorator:"Enable extra definition decorator",useExtraDefinitionDecoratorDesc:"Display a decorator at the end of the extra definition that this is an abbreviation definition.",extraDefinitionDecoratorOpacity:"Extra definition decorator opacity",extraDefinitionDecoratorOpacityDesc:"Opacity of the extra definition decorator. The value is the form of percentage.",extraDefinitionDecoratorContent:"Extra definition decorator content",extraDefinitionDecoratorContentDesc:"Content of the extra definition decorator. Two variables can be used: ${abbr} and ${tooltip}. To introduce certain information of the current definition into the content.",suffixesHeading:"Suffixes",detectAffixes:"Enable detect suffixes",detectAffixesDesc:"Detect supplementary suffixes for abbreviations.",affixes:"Suffix list",affixesPlaceholder:"A string separated by ,",affixesDesc:"The list content uses comma-separated string, for example: {placeholder}.",global:"Global",globalFile:"Global file",globalFileDesc:"Read abbreviations from this file and take effect globally."},Zt={button:qt,text:Jt,command:jt,notification:Ut,input:zt,list:_t,manager:Qt,menu:Xt,setting:Yt};var ct={};q(ct,{button:()=>te,command:()=>ie,default:()=>ce,input:()=>se,list:()=>ae,manager:()=>oe,menu:()=>re,notification:()=>ne,setting:()=>le,text:()=>ee});var te={delete:"\u5220\u9664",submit:"\u63D0\u4EA4",add:"\u6DFB\u52A0",back:"\u8FD4\u56DE"},ee={abbrLabel:"\u7F29\u7565\u8BED\uFF1A",abbrPlaceholder:"\u7F29\u5199",tipPlaceholder:"\u5168\u79F0"},ie={add:"\u6DFB\u52A0\u7F29\u7565\u8BED",copy:"\u590D\u5236\u5E76\u683C\u5F0F\u5316\u5185\u5BB9",insert:"\u63D2\u5165 Extra \u5B9A\u4E49",list:"\u7F29\u7565\u8BED\u5217\u8868",manage:"\u7BA1\u7406\u5168\u5C40\u7F29\u7565\u8BED"},ne={copied:"\u5185\u5BB9\u5DF2\u590D\u5236\uFF01",copyWarn:"\u8B66\u544A\uFF1A\u590D\u5236\u7684\u5185\u5BB9\u4E3A\u7A7A\uFF01",copyError:"\u9519\u8BEF\uFF1A\u65E0\u6CD5\u590D\u5236\u5185\u5BB9\uFF01",metadataAdded:"\u5DF2\u6DFB\u52A0\u5143\u6570\u636E\u7F29\u7565\u8BED\uFF1A{abbr}\u3002",metadataDeleted:"\u5DF2\u5220\u9664\u5143\u6570\u636E\u7F29\u7565\u8BED\uFF1A{abbr}\u3002",metadataError:"\u9519\u8BEF\uFF1A\u5143\u6570\u636E\u5173\u952E\u8BCD\u4E3A\u7A7A\uFF01",globalAdded:"\u5DF2\u6DFB\u52A0\u5168\u5C40\u7F29\u7565\u8BED\uFF1A{abbr}\u3002",globalDeleted:"\u5DF2\u5220\u9664\u5168\u5C40\u7F29\u7565\u8BED\uFF1A{abbr}\u3002",formatWarn:"\u8B66\u544A\uFF1A\u7F29\u7565\u8BED\u683C\u5F0F\u4E0D\u6B63\u786E\uFF01",notFoundWarn:"\u8B66\u544A\uFF1A\u672A\u627E\u5230\u539F\u59CB\u7F29\u7565\u8BED\uFF01",unexpectedError:"\u9519\u8BEF\uFF1A\u610F\u5916\u9519\u8BEF\uFF01",fileError:"\u9519\u8BEF\uFF1A\u672A\u627E\u5230\u6D3B\u52A8\u6587\u4EF6\uFF01",fileNotExistError:"\u9519\u8BEF\uFF1A\u6587\u4EF6\u4E0D\u5B58\u5728\uFF01"},se={editTitle:"\u7F16\u8F91\u7F29\u7565\u8BED ({type})",addTitle:"\u6DFB\u52A0\u5143\u6570\u636E\u7F29\u7565\u8BED"},ae={empty:"\u672A\u627E\u5230\u7F29\u7565\u8BED\u3002",placeholder:"\u8F93\u5165\u641C\u7D22\u8BCD",global:"\u5168\u5C40",globalTip:"\u5C06\u5176\u6DFB\u52A0\u5230\u5168\u5C40\u7F29\u7565\u8BED\u4E2D",type:"\u7C7B\u578B\uFF1A{type}",position:" - \u4F4D\u7F6E\uFF1A{position}"},oe={title:"\u7BA1\u7406\u5168\u5C40\u7F29\u7565\u8BED",addTip:"\u6DFB\u52A0\u65B0\u7684\u7F29\u7565\u8BED"},re={type:"\u7C7B\u578B\uFF1A{type}",text:"\u7F29\u5199\uFF1A{text}",tooltip:"\u5168\u79F0\uFF1A{tooltip}",line:"\u884C\u53F7\uFF1A{line}",edit:"\u7F16\u8F91\u7F29\u7565\u8BED",add:"\u6DFB\u52A0\u5230\u5168\u5C40\u7F29\u7565\u8BED",copyText:"\u590D\u5236\u7F29\u5199",copyTooltip:"\u590D\u5236\u5168\u79F0",copyMetadata:"\u590D\u5236\u5143\u6570\u636E\u683C\u5F0F\u5B9A\u4E49",copyExtra:"\u590D\u5236 Extra \u683C\u5F0F\u5B9A\u4E49",copyHtml:"\u590D\u5236 HTML \u683C\u5F0F\u5B9A\u4E49"},le={metadataKeyword:"\u5143\u6570\u636E\u5173\u952E\u8BCD",metadataKeywordDesc:"\u4ECE{placeholder}\u4E2D\u8BFB\u53D6\u7F29\u7565\u8BED\u4FE1\u606F\u7684\u952E\u540D\u3002",metadataKeywordPlaceholder:"\u8F93\u5165\u5173\u952E\u8BCD",properties:"\u5C5E\u6027",markInSourceMode:"\u5728\u6E90\u7801\u6A21\u5F0F\u4E2D\u6807\u8BB0\u7F29\u7565\u8BED",markInSourceModeDesc:"\u5728\u6E90\u7801\u6A21\u5F0F\u4E0B\u6807\u8BB0\u7F29\u7565\u8BED\uFF0C\u4E0E\u5728\u5B9E\u65F6\u9605\u89C8\u548C\u9605\u8BFB\u89C6\u56FE\u4E2D\u4E00\u6837\u3002",detectCJK:"\u542F\u7528\u975E\u7A7A\u683C\u5206\u9694\u8BED\u8A00\u7684\u7F29\u7565\u8BED\u68C0\u6D4B",detectCJKDesc:"\u68C0\u6D4B\u4E0D\u4F7F\u7528\u7A7A\u683C\u8FDB\u884C\u5206\u8BCD\u7684\u8BED\u8A00(\u5982 {placeholder})\u4E2D\u7684\u7F29\u7565\u8BED\u3002",globalAbbreviations:"\u5168\u5C40\u7F29\u7565\u8BED",globalAbbreviationsButton:"\u7BA1\u7406\u7F29\u7565\u8BED",globalAbbreviationsDesc:"\u914D\u7F6E\u5168\u5C40\u7F29\u7565\u8BED\uFF0C\u4F46\u5176\u4F18\u5148\u7EA7\u4F4E\u4E8E{placeholder}\u3002",extraHeading:"Markdown Extra \u8BED\u6CD5",useMarkdownExtraSyntax:"\u542F\u7528 Markdown Extra \u8BED\u6CD5\u652F\u6301",useMarkdownExtraSyntaxDesc:"\u5207\u6362\u6B64\u8BBE\u7F6E\u4EE5\u542F\u7528\u6216\u7981\u7528\u8BE5\u529F\u80FD\u3002\u5B9A\u4E49\u683C\u5F0F\uFF1A{placeholder}\u3002",useExtraDefinitionDecorator:"\u542F\u7528 Extra \u5B9A\u4E49\u88C5\u9970\u5668",useExtraDefinitionDecoratorDesc:"\u663E\u793A\u4E00\u4E2A\u88C5\u9970\u5668\u5143\u7D20\u5728 Extra \u5B9A\u4E49\u672B\u5C3E\uFF0C\u8868\u660E\u8FD9\u662F\u4E00\u4E2A\u7F29\u7565\u8BED\u5B9A\u4E49\u3002",extraDefinitionDecoratorOpacity:"Extra \u5B9A\u4E49\u88C5\u9970\u5668\u4E0D\u900F\u660E\u5EA6",extraDefinitionDecoratorOpacityDesc:"Extra \u5B9A\u4E49\u88C5\u9970\u5668\u7684\u4E0D\u900F\u660E\u5EA6\uFF0C\u503C\u662F\u767E\u5206\u6BD4\u7684\u5F62\u5F0F\u3002",extraDefinitionDecoratorContent:"Extra \u5B9A\u4E49\u88C5\u9970\u5668\u5185\u5BB9",extraDefinitionDecoratorContentDesc:"Extra \u5B9A\u4E49\u88C5\u9970\u5668\u7684\u5185\u5BB9\u3002\u53EF\u4EE5\u4F7F\u7528\u4E24\u4E2A\u53D8\u91CF\uFF1A${abbr} \u548C ${tooltip}\uFF0C\u7528\u4E8E\u5C06\u5F53\u524D\u5B9A\u4E49\u7684\u67D0\u4E9B\u4FE1\u606F\u5F15\u5165\u5185\u5BB9\u3002",suffixesHeading:"\u540E\u7F00",detectAffixes:"\u542F\u7528\u540E\u7F00\u68C0\u6D4B",detectAffixesDesc:"\u68C0\u6D4B\u5E26\u6709\u8BCD\u5C3E\u7684\u7F29\u7565\u8BED\u3002",affixes:"\u540E\u7F00\u5217\u8868",affixesPlaceholder:"\u7528\u9017\u53F7(,)\u5206\u9694\u7684\u5B57\u7B26\u4E32",affixesDesc:"\u5217\u8868\u5185\u5BB9\u4E3A\u4F7F\u7528\u9017\u53F7(,)\u5206\u9694\u7684\u5B57\u7B26\u4E32\uFF0C\u4F8B\u5982\uFF1A{placeholder}\u3002",global:"\u5168\u5C40",globalFile:"\u5168\u5C40\u6587\u4EF6",globalFileDesc:"\u4ECE\u8BE5\u6587\u4EF6\u4E2D\u8BFB\u53D6\u7F29\u7565\u8BED\u5E76\u5168\u5C40\u751F\u6548\u3002"},ce={button:te,text:ee,command:ie,notification:ne,input:se,list:ae,manager:oe,menu:re,setting:le};var dt={};q(dt,{button:()=>de,command:()=>he,default:()=>xe,input:()=>be,list:()=>ue,manager:()=>ge,menu:()=>me,notification:()=>fe,setting:()=>ve,text:()=>pe});var de={delete:"\u522A\u9664",submit:"\u63D0\u4EA4",add:"\u65B0\u589E",back:"\u8FD4\u56DE"},pe={abbrLabel:"\u7E2E\u7565\u8A9E\uFF1A",abbrPlaceholder:"\u7E2E\u5BEB",tipPlaceholder:"\u5168\u7A31"},he={add:"\u65B0\u589E\u7E2E\u7565\u8A9E",copy:"\u8907\u88FD\u4E26\u683C\u5F0F\u5316\u5167\u5BB9",insert:"\u63D2\u5165 Extra \u5B9A\u7FA9",list:"\u7E2E\u7565\u8A9E\u5217\u8868",manage:"\u7BA1\u7406\u5168\u57DF\u6027\u7E2E\u7565\u8A9E"},fe={copied:"\u5167\u5BB9\u5DF2\u8907\u88FD\uFF01",copyWarn:"\u8B66\u544A\uFF1A\u8907\u88FD\u7684\u5167\u5BB9\u70BA\u7A7A\uFF01",copyError:"\u932F\u8AA4\uFF1A\u7121\u6CD5\u8907\u88FD\u5167\u5BB9\uFF01",metadataAdded:"\u5DF2\u65B0\u589E\u5143\u8CC7\u6599\u7E2E\u7565\u8A9E\uFF1A{abbr}\u3002",metadataDeleted:"\u5DF2\u522A\u9664\u5143\u8CC7\u6599\u7E2E\u7565\u8A9E\uFF1A{abbr}\u3002",metadataError:"\u932F\u8AA4\uFF1A\u5143\u8CC7\u6599\u95DC\u9375\u8A5E\u70BA\u7A7A\uFF01",globalAdded:"\u5DF2\u65B0\u589E\u5168\u57DF\u6027\u7E2E\u7565\u8A9E\uFF1A{abbr}\u3002",globalDeleted:"\u5DF2\u522A\u9664\u5168\u57DF\u6027\u7E2E\u7565\u8A9E\uFF1A{abbr}\u3002",formatWarn:"\u8B66\u544A\uFF1A\u7E2E\u7565\u8A9E\u683C\u5F0F\u4E0D\u6B63\u78BA\uFF01",notFoundWarn:"\u8B66\u544A\uFF1A\u672A\u627E\u5230\u539F\u59CB\u7E2E\u7565\u8A9E\uFF01",unexpectedError:"\u932F\u8AA4\uFF1A\u610F\u5916\u932F\u8AA4\uFF01",fileError:"\u932F\u8AA4\uFF1A\u672A\u627E\u5230\u6D3B\u52D5\u6A94\u6848\uFF01",fileNotExistError:"\u932F\u8AA4\uFF1A\u6A94\u6848\u4E0D\u5B58\u5728\uFF01"},be={editTitle:"\u7DE8\u8F2F\u7E2E\u7565\u8A9E ({type})",addTitle:"\u65B0\u589E\u5143\u8CC7\u6599\u7E2E\u7565\u8A9E"},ue={empty:"\u672A\u627E\u5230\u7E2E\u7565\u8A9E\u3002",placeholder:"\u8F38\u5165\u641C\u5C0B\u8A5E",global:"\u5168\u57DF\u6027",globalTip:"\u5C07\u5176\u65B0\u589E\u5230\u5168\u57DF\u6027\u7E2E\u7565\u8A9E\u4E2D",type:"\u578B\u5225\uFF1A{type}",position:" - \u4F4D\u7F6E\uFF1A{position}"},ge={title:"\u7BA1\u7406\u5168\u57DF\u6027\u7E2E\u7565\u8A9E",addTip:"\u65B0\u589E\u65B0\u7684\u7E2E\u7565\u8A9E"},me={type:"\u578B\u5225\uFF1A{type}",text:"\u7E2E\u5BEB\uFF1A{text}",tooltip:"\u5168\u7A31\uFF1A{tooltip}",line:"\u884C\u865F\uFF1A{line}",edit:"\u7DE8\u8F2F\u7E2E\u7565\u8A9E",add:"\u65B0\u589E\u5230\u5168\u57DF\u6027\u7E2E\u7565\u8A9E",copyText:"\u8907\u88FD\u7E2E\u5BEB",copyTooltip:"\u8907\u88FD\u5168\u7A31",copyMetadata:"\u8907\u88FD\u5143\u8CC7\u6599\u683C\u5F0F\u5B9A\u7FA9",copyExtra:"\u8907\u88FD Extra \u683C\u5F0F\u5B9A\u7FA9",copyHtml:"\u8907\u88FD HTML \u683C\u5F0F\u5B9A\u7FA9"},ve={metadataKeyword:"\u5143\u8CC7\u6599\u95DC\u9375\u8A5E",metadataKeywordDesc:"\u5F9E{placeholder}\u4E2D\u8B80\u53D6\u7E2E\u7565\u8A9E\u8CC7\u8A0A\u7684\u9375\u540D\u3002",metadataKeywordPlaceholder:"\u8F38\u5165\u95DC\u9375\u8A5E",properties:"\u5C6C\u6027",markInSourceMode:"\u5728\u539F\u59CB\u78BC\u6A21\u5F0F\u4E2D\u6A19\u8A18\u7E2E\u7565\u8A9E",markInSourceModeDesc:"\u5728\u539F\u59CB\u78BC\u6A21\u5F0F\u4E0B\u6A19\u8A18\u7E2E\u7565\u8A9E\uFF0C\u8207\u5728\u5BE6\u969B\u9810\u89BD\u548C\u95B1\u8B80\u4E2D\u4E00\u6A23\u3002",detectCJK:"\u555F\u7528\u975E\u7A7A\u683C\u5206\u9694\u8A9E\u8A00\u7684\u7E2E\u7565\u8A9E\u6AA2\u6E2C",detectCJKDesc:"\u6AA2\u6E2C\u4E0D\u4F7F\u7528\u7A7A\u683C\u9032\u884C\u5206\u8A5E\u7684\u8A9E\u8A00(\u5982 {placeholder})\u4E2D\u7684\u7E2E\u7565\u8A9E\u3002",globalAbbreviations:"\u5168\u57DF\u6027\u7E2E\u7565\u8A9E",globalAbbreviationsButton:"\u7BA1\u7406\u7E2E\u7565\u8A9E",globalAbbreviationsDesc:"\u914D\u7F6E\u5168\u57DF\u6027\u7E2E\u7565\u8A9E\uFF0C\u4F46\u5176\u512A\u5148\u9806\u5E8F\u4F4E\u65BC{placeholder}\u3002",extraHeading:"Markdown Extra \u8A9E\u6CD5",useMarkdownExtraSyntax:"\u555F\u7528 Markdown Extra \u8A9E\u6CD5\u652F\u63F4",useMarkdownExtraSyntaxDesc:"\u5207\u63DB\u6B64\u8A2D\u5B9A\u4EE5\u555F\u7528\u6216\u505C\u7528\u8A72\u529F\u80FD\u3002\u5B9A\u7FA9\u683C\u5F0F\uFF1A{placeholder}\u3002",useExtraDefinitionDecorator:"\u555F\u7528 Extra \u5B9A\u7FA9\u88DD\u98FE\u5668",useExtraDefinitionDecoratorDesc:"\u986F\u793A\u4E00\u500B\u88DD\u98FE\u5668\u5143\u7D20\u5728 Extra \u5B9A\u7FA9\u672B\u5C3E\uFF0C\u8868\u660E\u9019\u662F\u4E00\u500B\u7E2E\u7565\u8A9E\u5B9A\u7FA9\u3002",extraDefinitionDecoratorOpacity:"Extra \u5B9A\u7FA9\u88DD\u98FE\u5668\u4E0D\u900F\u660E\u5EA6",extraDefinitionDecoratorOpacityDesc:"Extra \u5B9A\u7FA9\u88DD\u98FE\u5668\u7684\u4E0D\u900F\u660E\u5EA6\uFF0C\u503C\u662F\u767E\u5206\u6BD4\u7684\u5F62\u5F0F\u3002",extraDefinitionDecoratorContent:"Extra \u5B9A\u7FA9\u88DD\u98FE\u5668\u5167\u5BB9",extraDefinitionDecoratorContentDesc:"Extra \u5B9A\u7FA9\u88DD\u98FE\u5668\u7684\u5167\u5BB9\u3002\u53EF\u4EE5\u4F7F\u7528\u5169\u500B\u8B8A\u6578\uFF1A${abbr} \u548C ${tooltip}\uFF0C\u7528\u65BC\u5C07\u7576\u524D\u5B9A\u7FA9\u7684\u67D0\u4E9B\u8CC7\u8A0A\u5F15\u5165\u5167\u5BB9\u3002",suffixesHeading:"\u5B57\u5C3E",detectAffixes:"\u555F\u7528\u5B57\u5C3E\u6AA2\u6E2C",detectAffixesDesc:"\u6AA2\u6E2C\u5E36\u6709\u5B57\u5C3E\u7684\u7E2E\u7565\u8A9E\u3002",affixes:"\u5B57\u5C3E\u5217\u8868",affixesPlaceholder:"\u7528\u9017\u865F(,)\u5206\u9694\u7684\u5B57\u4E32",affixesDesc:"\u5217\u8868\u5167\u5BB9\u70BA\u4F7F\u7528\u9017\u865F(,)\u5206\u9694\u7684\u5B57\u4E32\uFF0C\u4F8B\u5982\uFF1A{placeholder}\u3002",global:"\u5168\u57DF\u6027",globalFile:"\u5168\u57DF\u6027\u6A94\u6848",globalFileDesc:"\u5F9E\u8A72\u6A94\u6848\u4E2D\u8B80\u53D6\u7E2E\u7565\u8A9E\u4E26\u5168\u57DF\u6027\u751F\u6548\u3002"},xe={button:de,text:pe,command:he,notification:fe,input:be,list:ue,manager:ge,menu:me,setting:ve};var pt=require("obsidian"),J=class{constructor(e,t){this.messages=e,this.locale=t!=null?t:(0,pt.getLanguage)();let i=this.messages[this.locale];typeof i>"u"?this.currentMessage=this.messages.en:this.currentMessage=i}setLocale(e){this.locale=e!=null?e:(0,pt.getLanguage)();let t=this.messages[this.locale];typeof t>"u"?this.currentMessage=this.messages.en:this.currentMessage=t}t(e,t){let i=e.split("."),n=this.currentMessage;for(let s of i)if(typeof n=="object"&&n)n=n[s];else break;return typeof n>"u"||typeof n=="object"?e:n.replace(/\{(\w+)\}/g,(s,o)=>t&&t[o]!=null?String(t[o]):`{${o}}`)}getPlaceholderTuple(e,t="{placeholder}"){let i=this.t(e).split(t);return i.length===1?[i[0],""]:i.length>=2?[i[0],i[1]]:["",""]}};var xt=new J({en:lt,zh:ct,"zh-TW":dt});var C="abbreviations-plugin-abbr-element",ht="abbreviations-plugin-extra-definition",yt="abbreviations-plugin-extra-asterisk",K="abbreviations-plugin-extra-definition-line",At="abbreviations-plugin-preview-decorator",kt="abbreviations-plugin-source-decorator",O="p, li, h1, h2, h3, h4, h5, h6, th, td, .table-cell-wrapper, .callout-title-inner",D="---";function wt(a){return/\s/.test(a)}function F(a){return a==="-"||a==="&"?!1:/\s/.test(a)?!0:!/^[\p{L}\p{N}\p{Ideographic}]$/u.test(a)}function B(a){if(a==="")return!1;for(let e of a)if(F(e))return!1;return!0}function v(a,e){return a&&e?a.split(e).length-1:0}function Et(a){let e=[],t=0,i=!0,n="";for(let s of a){let o=F(s);t===0?(++t,i=o,n+=s):i===o?n+=s:(e.push({text:n,isSpecial:i}),i=o,n=s,++t)}return n&&e.push({text:n,isSpecial:i}),e}function j(a){let e=a.match(/^\*\[([^[\]]+?)\]:(\s+.*)?$/);return e?{key:e[1],title:(e[2]||"").trim()}:null}function Ct(a){let e=a.split(`
`),t=0;for(let i of e)if(i.match(/^\*\[[^[\]]+?\]:(\s+.*)?$/)){t=0;continue}else if(i.match(/^\[[^[\]]+?\]:(\s+.*)?$/))if(t===0){t=1;continue}else t=0;else return!1;return t===0}function Dt(a){return Array.from(new Set(a.split(",").map(e=>e.trim()).filter(e=>e)))}function Mt(a){if(typeof a=="string"){let e=a.trim(),t=e.indexOf(":");if(t>0)return{key:e.substring(0,t).trim(),title:e.substring(t+1).trim(),type:"metadata"}}else if(typeof a=="object"&&a){let e=Object.keys(a);if(e.length===1&&typeof a[e[0]]=="string")return{key:e[0],title:a[e[0]],type:"metadata"}}return null}function ye(a,e){if(e.length===0)return[];let t=[],i=0;for(;i<a.length;){let n=a.indexOf(e,i);if(n===-1)break;t.push(n),i=n+1}return t}function ft(a,e){let t=a.index,i=a.index+a.text.length,n=e.index,s=e.index+e.text.length;return t===n&&i===s?"same":t<=n&&i>=s?"contain":t>=n&&i<=s?"included":i>n&&t<s?"intersection":"unrelated"}function Ae(a){let e=[];if(a.length===0)return[];let t=a.reduce((i,n,s)=>n.abbrPos<0?s:i,0);for(let i=t;i>=0;i--){let n=!0;for(let s of e)if(ft(s,a[i])!=="unrelated"){n=!1;break}if(n){let{abbrPos:s,...o}=a[i];e.push({...o})}}for(let i=t+1;i<a.length;i++){let n=!0;for(let s of e)if(ft(s,a[i])!=="unrelated"){n=!1;break}if(n){let{abbrPos:s,...o}=a[i];e.push({...o})}}return e}function U(a,e,t=1,i=[],n=!1){let s=null,o=null,r=[],d=i.length>0;for(let l=e.length-1;l>=0;l--){let c=e[l];if(c.key)if(a===c.key)if(s={...c,index:0,text:a},c.type==="extra"){if(c.position<=t)break}else break;else{if(d){let p=!1;for(let h of i)if(a===c.key+h){o={...c,index:0,text:a},p=!0;break}p&&(c.type==="extra"?c.position<=t&&(d=!1):d=!1)}if(n&&s==null&&o==null){let p=ye(a,c.key);for(let h of p){let m=!0;r=r.filter(x=>{let u=ft(x,{index:h,text:c.key});if(u==="same"){if(x.abbrPos>0)return!1;m=!1}else{if(u==="included")return!1;u==="contain"&&(m=!1)}return!0}),m&&r.push({...c,index:h,text:c.key,abbrPos:c.type==="extra"?c.position-t:-1})}}}}if(s!=null)return s.title?s:null;if(o!=null)return o.title?o:null;if(r.length>0){let l=Ae(r).filter(c=>c.title).sort((c,p)=>c.index-p.index);return l.length>0?l:null}return null}function $(a){if(a.length===0)return!0;let e=new Set;for(let t of a)if(t.key){if(t.type==="extra")return!1;t.title?e.add(t.key):e.delete(t.key)}return e.size===0}function P(a,e){let t=[];return e&&typeof a=="object"&&a&&Array.isArray(a[e])&&a[e].forEach(n=>{let s=Mt(n);s&&t.push(s)}),t}function bt(a,e,t){if(Array.isArray(e[t])){let i=e[t],n=i.length-1;for(;n>=0;){let s=Mt(i[n]);if(s&&s.key===a.key&&s.title===a.title)break;n--}return n}return-1}function ut(a,e){let t=e.length-1;for(;t>=0;){let i=e[t];if(i&&i.key===a.key&&i.title===a.title)break;t--}return t}var L=class{constructor(){this.state="",this.codeBlocks={graveCount:0},this.quotes={level:0}}isMetadataState(){return this.state==="metadata"}};var Tt=require("obsidian");function St(a){return typeof a=="object"&&a?a:null}function ke(a){try{let e=JSON.parse(a);return St(e)}catch(e){return null}}function we(a){try{let e=(0,Tt.parseYaml)(a);return St(e)}catch(e){return null}}function It(a){let e=we(a);return e===null&&(e=ke(a)),e}var E=class extends L{constructor(e,t,i){super(),this.abbreviations=e.map(({key:n,title:s})=>({key:n,title:s,type:"global"})).filter(n=>n.key),this.abbreviationKeyword=t,this.parseOption=i,this.metadataBuffer=[]}readAbbreviationsFromCache(e){let t=P(e,this.abbreviationKeyword);this.abbreviations.push(...t)}isAbbreviationsEmpty(){return $(this.abbreviations)}handler(e,t){if(t===1&&e===D){this.state="metadata";return}if(this.quotes.level>0&&this.state!=="math"&&e.trim().length===0){this.state="",this.codeBlocks.graveCount=0,this.quotes.level=0;return}if(this.state===""){if(/^(?:[ ]{4,}|\t|[> ]+(?:[ ]{5,}|\t))/.test(e))return;let i=e.match(/^([> ]*`{3,})[^`]*$/);if(i){this.state="codeBlocks",this.codeBlocks.graveCount=v(i[1],"`"),this.quotes.level=v(i[1],">");return}let n=e.match(/^([> ]*)\$\$(.*)/);if(n&&!n[2].trim().endsWith("$$")){this.state="math",this.quotes.level=v(n[1],">");return}if(this.parseOption.extra){let s=j(e);s&&this.abbreviations.push({key:s.key,title:s.title,type:"extra",position:t})}}else if(this.state==="metadata")if(e===D){if(this.parseOption.metadata&&this.abbreviationKeyword&&this.metadataBuffer.length>0){let i=It(this.metadataBuffer.join(`
`));if(i){let n=P(i,this.abbreviationKeyword);this.abbreviations.push(...n)}}this.state=""}else this.parseOption.metadata&&this.abbreviationKeyword&&this.metadataBuffer.push(e);else if(this.state==="codeBlocks"){let i=e.match(/^([> ]*`{3,})([^`]*)$/);if(i){let n=v(i[1],">"),s=v(i[1],"`");n<this.quotes.level?(this.quotes.level=n,this.codeBlocks.graveCount=s):n===this.quotes.level&&s>=this.codeBlocks.graveCount&&i[2].trim().length===0&&(this.state="")}}else if(this.state==="math"){let i=e.match(/^([> ]*)\$\$/);if(i){let n=v(i[1],">");n<this.quotes.level?this.quotes.level=n:n===this.quotes.level&&(this.state="")}}}};var z=class{constructor(){this.grave={isStart:!1,startLen:0,count:0};this.link={mode:"end",wait:"",openLen:0,closeCount:0,isInlineFootnote:!1};this.init()}init(){this.marks=[],this.buffer="",this.position=0,this.mode="separator",this.grave.isStart=!1,this.grave.startLen=0,this.grave.count=0,this.link.mode="end",this.link.wait="",this.link.openLen=0,this.link.closeCount=0,this.link.isInlineFootnote=!1}charHandler(e,t){if(this.mode==="inlineCode")t==="`"?(this.grave.isStart?this.grave.startLen++:this.grave.count++,this.buffer+=t):(this.grave.isStart=!1,this.grave.startLen===this.grave.count?(this.mode=F(t)?"separator":"word",this.grave.startLen=0,this.grave.count=0,this.buffer=t,this.position=e):(this.grave.count=0,this.buffer+=t));else if(this.mode==="inlineMath")t==="$"&&!this.isPrefixEscape(-1,!0)?(this.mode="word",this.buffer="",this.position=e+1):this.buffer+=t;else if(this.mode==="link"&&this.link.mode==="text"&&(this.link.wait!=="URLOpen"||this.link.wait==="URLOpen"&&t==="("))this.link.wait==="URLOpen"&&t==="("?this.link.wait="URLClose":this.link.wait==="textClose"&&t==="]"&&!this.isPrefixEscape()?(this.link.wait="",this.link.mode="end"):this.link.wait==="URLClose"&&t===")"&&!this.isPrefixEscape()?(this.link.wait="",this.link.mode="end"):t==="["&&!this.isPrefixEscape()&&this.link.openLen===1?this.link.openLen=2:t==="]"&&!this.isPrefixEscape()&&(this.link.closeCount++,this.link.openLen===1&&this.link.closeCount===1?this.link.isInlineFootnote?(this.link.wait="",this.link.mode="end"):this.link.wait="URLOpen":this.link.openLen===2&&this.link.closeCount===1?this.link.wait="textClose":this.link.mode="end"),this.buffer+=t;else if(t==="`"&&!this.isPrefixEscape())this.pushMark(),this.mode="inlineCode",this.grave.isStart=!0,this.grave.startLen=1,this.grave.count=0,this.buffer=t,this.position=e;else if(t==="$"&&!this.isPrefixEscape())this.pushMark(),this.mode="inlineMath",this.buffer=t,this.position=e;else if(t==="["&&!this.isPrefixEscape())this.pushMark(),this.mode="link",this.link.isInlineFootnote=this.buffer.at(-1)==="^"&&!this.isPrefixEscape(-2),this.link.mode="text",this.link.wait="",this.link.openLen=1,this.link.closeCount=0,this.buffer=t,this.position=e;else if(this.mode==="tag"){if("-_/".indexOf(t)>-1){this.buffer+=t;return}F(t)?(this.mode="separator",this.buffer=t,this.position=e):this.buffer+=t}else if(t==="#"&&!this.isPrefixEscape())this.mode==="separator"?this.buffer.length===0||wt(this.buffer.at(-1)||"")?(this.mode="tag",this.buffer=t,this.position=e):this.buffer+=t:(this.pushMark(),this.mode="separator",this.buffer=t,this.position=e);else{let i=F(t)?"separator":"word";i===this.mode?this.buffer+=t:(this.pushMark(),this.mode=i,this.buffer=t,this.position=e)}}pushMark(){this.mode==="word"&&this.buffer.length>0&&this.marks.push({text:this.buffer,position:this.position})}isPrefixEscape(e=-1,t=!1){return t?this.buffer.at(e)==="\\":this.buffer.at(e)==="\\"&&this.buffer.at(e-1)!=="\\"}handler(e){this.init();for(let t=0;t<e.length;t++)this.charHandler(t,e[t]);return this.pushMark(),this.marks}};var N=class extends L{constructor(e,t,i=[],n=!1){super(),this.abbreviations=e,this.skipExtraDefinition=t,this.affixList=i,this.detectCJK=n,this.listState=!1,this.mark=new z}handler(e,t,i){if(t===1&&e===D){this.state="metadata",i([],null);return}if(this.quotes.level>0&&this.state!=="math"&&e.trim().length===0){this.state="",this.codeBlocks.graveCount=0,this.quotes.level=0,this.listState=!1,i([],null);return}if(this.state===""){if(/^(?:[ ]{4,}|\t|[> ]+(?:[ ]{5,}|\t))/.test(e)&&!this.listState){i([],null);return}e.match(/^(?:[> \t]*[-*+][ ]{1,4}|[> \t]*\d+\.[ ]{1,4})/)?this.listState=!0:this.listState=!1;let n=e.match(/^([> ]*`{3,})[^`]*$/);if(n){this.state="codeBlocks",this.codeBlocks.graveCount=v(n[1],"`"),this.quotes.level=v(n[1],">"),i([],null);return}let s=e.match(/^([> ]*)\$\$(.*)/);if(s&&!s[2].trim().endsWith("$$")){this.state="math",this.quotes.level=v(s[1],">"),i([],null);return}if(this.skipExtraDefinition){let d=j(e);if(d){i([],d);return}}let o=[];this.mark.handler(e).forEach(d=>{let l=U(d.text,this.abbreviations,t,this.affixList,this.detectCJK);if(Array.isArray(l))for(let c of l){let{index:p,...h}=c;o.push({index:d.position+p,...h})}else if(l){let{index:c,text:p,...h}=l;o.push({index:d.position,text:d.text,...h})}}),i(o,null);return}else if(this.state==="metadata"){if(e===D){i([],null),this.state="";return}}else if(this.state==="codeBlocks"){let n=e.match(/^([> ]*`{3,})([^`]*)$/);if(n){let s=v(n[1],">"),o=v(n[1],"`");s<this.quotes.level?(this.quotes.level=s,this.codeBlocks.graveCount=o):s===this.quotes.level&&o>=this.codeBlocks.graveCount&&n[2].trim().length===0&&(this.state="")}}else if(this.state==="math"){let n=e.match(/^([> ]*)\$\$/);if(n){let s=v(n[1],">");s<this.quotes.level?this.quotes.level=s:s===this.quotes.level&&(this.state="")}}i([],null)}};var Ee={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","&":"&amp;"};function W(a){return a.replace(/[<>"'&]/g,e=>Ee[e])}function Ce(a,e){let t=[],i=0;return e.forEach(n=>{n.index>i&&t.push(a.substring(i,n.index)),t.push(`<abbr title="${W(n.title)}">${W(n.text)}</abbr>`),i=n.index+n.text.length}),i<a.length&&t.push(a.substring(i)),t.join("")}function Ft(a,e,t,i,n,s=!1){let o=[],r=new E(e,t,{metadata:!0,extra:i}),d=a.split(`
`);for(let p=0;p<d.length;p++){let h=d[p],m=p+1;if(r.handler(h,m),!i&&!r.isMetadataState())break}let l=new N(r.abbreviations,i,n,s),c=!1;for(let p=0;p<d.length;p++){let h=d[p],m=p+1;l.handler(h,m,(x,u)=>{if(!l.isMetadataState()){if(h===""){if(c&&o.at(-1)===""){c=!1;return}o.push(""),c=!1;return}if(u){c=!0;return}x.length===0?o.push(h):o.push(Ce(h,x)),c=!1}})}return o.join(`
`)}var mt=require("obsidian"),M=require("@codemirror/view"),T=require("@codemirror/state");function gt(a,e,t=1,i=[],n=!1){var o;if(["DEL","EM","MARK","STRONG"].includes(a.nodeName)){let r=a.childNodes;for(let d=0;d<r.length;d++)gt(r[d],e,t,i,n)}if(a.nodeType!==Node.TEXT_NODE)return;let s=a.textContent;if(s){let r=createFragment();Et(s).forEach(l=>{if(l.isSpecial)r.appendChild(document.createTextNode(l.text));else{let c=U(l.text,e,t,i,n);if(Array.isArray(c)){let p=0;for(let h of c){h.index>p&&r.appendChild(document.createTextNode(l.text.substring(p,h.index)));let m=r.createEl("abbr",{cls:C,title:h.title,text:h.text,attr:{"data-abbr-key":h.key,"data-abbr-type":h.type,"data-abbr-position":(h.position||-1).toString()}});r.appendChild(m),p=h.index+h.text.length}p<l.text.length&&r.appendChild(document.createTextNode(l.text.substring(p)))}else if(c){let p=r.createEl("abbr",{cls:C,title:c.title,text:l.text,attr:{"data-abbr-key":c.key,"data-abbr-type":c.type,"data-abbr-position":(c.position||-1).toString()}});r.appendChild(p)}else r.appendChild(document.createTextNode(l.text))}}),(o=a.parentNode)==null||o.replaceChild(r,a)}}function _(a,e,t=[],i=!1){if(!$(e))for(let n of a){let s=n.childNodes;for(let o=0;o<s.length;o++){let r=s[o];gt(r,e,1,t,i)}}}function Pt(a,e,t,i=[],n=!1){if(!$(t))for(let s of e){let o=a.getSectionInfo(s),r=(o==null?void 0:o.lineStart)||1,d=s.childNodes;for(let l=0;l<d.length;l++){let c=d[l];gt(c,t,r,i,n)}}}var vt=T.StateEffect.define(),Lt=T.StateField.define({create(){return M.Decoration.none},update(a,e){for(let t of e.effects)if(t.is(vt))return t.value;return a.map(e.changes)},provide:a=>M.EditorView.decorations.from(a)}),X=T.StateEffect.define(),Nt=T.StateField.define({create:()=>!1,update(a,e){for(let t of e.effects)if(t.is(X))return t.value;return a}}),Q=class{constructor(e,t){this.getPluginData=t,this.updateDecorations(e,e.state.field(mt.editorLivePreviewField))}update(e){(e.docChanged||e.viewportChanged||e.transactions.some(t=>t.effects.some(i=>i.is(X))))&&this.updateDecorations(e.view,e.state.field(mt.editorLivePreviewField))}destroy(){}async updateDecorations(e,t){let i=await this.getPluginData();if(t||i.markInSourceMode){let n=new T.RangeSetBuilder,s=e.state.doc,o=new E(i.globalAbbreviations,i.metadataKeyword,{metadata:!0,extra:i.useMarkdownExtraSyntax});for(let l=1;l<s.lines+1;l++){let p=s.line(l).text;if(l===1&&p!==D&&o.readAbbreviationsFromCache(i.frontmatterCache),o.handler(p,l),!i.useMarkdownExtraSyntax&&!o.isMetadataState())break}let r=i.globalFileAbbreviations.concat(o.abbreviations);if(!o.isAbbreviationsEmpty()){let l=new N(r,i.useMarkdownExtraSyntax,i.suffixes,i.detectCJK);for(let c=1;c<s.lines+1;c++){let p=s.line(c),h=p.text;l.handler(h,c,(m,x)=>{if(x){let u={class:i.useExtraDefinitionDecorator?`${K} ${t?At:kt}`:K,"data-abbr-key":x.key,"data-abbr-title":x.title};i.useExtraDefinitionDecorator&&(u["data-abbr-decorator"]=i.extraDefinitionDecoratorContent.replaceAll("${abbr}",x.key).replaceAll("${tooltip}",x.title),u["data-decorator-opacity"]=`${i.extraDefinitionDecoratorOpacity}%`);let S=M.Decoration.line({attributes:u});if(n.add(p.from,p.from,S),t){let f=M.Decoration.mark({attributes:{class:yt}});n.add(p.from,p.from+1,f)}}else m.forEach(u=>{let S=p.from+u.index,f=S+u.text.length,b=M.Decoration.mark({tagName:"abbr",attributes:{text:u.text,title:u.title,class:C,"data-abbr-key":u.key,"data-abbr-type":u.type,"data-abbr-position":(u.position||-1).toString()}});n.add(S,f,b)})})}}let d=n.finish();e.dispatch({effects:vt.of(d)}),_(e.dom.findAll(O),r,i.suffixes,i.detectCJK)}else e.dispatch({effects:vt.of(M.Decoration.none)})}};var Kt=require("obsidian"),Ot=require("@codemirror/view");var Y=class{constructor(e,t){this.plugin=e,this.menuAction=t}readingViewDomHandlers(e){let t=e.target;if(t&&t.classList.contains(C)){let i=t.dataset.abbrType,n=t.dataset.abbrKey;if(!i||!n)return;e.preventDefault(),e.stopPropagation();let s=t.title,o=parseInt(t.dataset.abbrPosition||"")||-1,r={key:n,type:i,title:s,position:o};this.menuGenerator(r).showAtMouseEvent(e)}}editorViewDomHandlers(){return Ot.EditorView.domEventHandlers({contextmenu:e=>{let t=e.target;if(t)if(t.classList.contains(C)){let i=t.dataset.abbrType,n=t.dataset.abbrKey;if(!i||!n)return!1;e.preventDefault(),e.stopPropagation();let s=t.title,o=parseInt(t.dataset.abbrPosition||"")||-1,r={key:n,type:i,title:s,position:o};return this.menuGenerator(r).showAtMouseEvent(e),!0}else{let i=t.closest("."+K);if(i){let n=i.dataset.abbrKey;if(!n)return!1;e.preventDefault(),e.stopPropagation();let s=i.dataset.abbrTitle||"",o={key:n,type:"extra",title:s,position:-1};return this.menuGenerator(o,!0).showAtMouseEvent(e),!0}}return!1}})}menuGenerator(e,t=!1){let i=new Kt.Menu;return i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.type",{type:t?"definition":e.type})).setIcon("type").setDisabled(!0)}),i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.text",{text:e.key})).setIcon("whole-word").setDisabled(!0)}),i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.tooltip",{tooltip:e.title})).setIcon("message-square-quote").setDisabled(!0)}),e.type==="extra"&&!t&&i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.line",{line:e.position})).setIcon("map-pin").setDisabled(!0)}),i.addSeparator(),t||i.addItem(n=>n.setTitle(this.plugin.i18n.t("menu.edit")).setIcon("square-pen").onClick(()=>{this.menuAction(e,"edit")})),(e.type==="metadata"||e.type==="extra")&&i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.add")).setIcon("square-plus").onClick(()=>{this.menuAction(e,"global")})}),i.addSeparator(),i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.copyText")).setIcon("copy").onClick(()=>{this.menuAction(e,"copy-text")})}),e.title&&i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.copyTooltip")).setIcon("copy").onClick(()=>{this.menuAction(e,"copy-title")})}),i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.copyMetadata")).setIcon("copy").onClick(()=>{this.menuAction(e,"copy-metadata")})}),i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.copyExtra")).setIcon("copy").onClick(()=>{this.menuAction(e,"copy-extra")})}),i.addItem(n=>{n.setTitle(this.plugin.i18n.t("menu.copyHtml")).setIcon("copy").onClick(()=>{this.menuAction(e,"copy-html")})}),i}};var et=require("obsidian"),tt=class tt extends et.FuzzySuggestModal{constructor(e,t,i,n,s){super(e),this.plugin=t,this.abbrList=i,this.selectedText=n,this.action=s,this.emptyStateText=this.plugin.i18n.t("list.empty"),this.setPlaceholder(this.plugin.i18n.t("list.placeholder"))}onOpen(){let e=this.selectedText.replace(/\n/," ").trim();this.inputEl.value=e,this.inputEl.dispatchEvent(new InputEvent("input"))}getItems(){return this.abbrList}getItemText(e){return`${e.key}: ${e.title}`}onChooseItem(e){this.action(e,"edit")}renderSuggestion(e,t){let i=t.createDiv("abbreviations-plugin-list-item-main"),n=i.createSpan("abbreviations-plugin-list-item-suggestion");(0,et.renderResults)(n,`${e.item.key}: ${e.item.title}`,e.match);let s=i.createSpan("abbreviations-plugin-list-item-buttons");(e.item.type==="metadata"||e.item.type==="extra")&&s.createEl("button",{cls:tt.ButtonCls,text:this.plugin.i18n.t("list.global"),title:this.plugin.i18n.t("list.globalTip")}).onClickEvent(o=>{o.stopPropagation(),this.action(e.item,"global"),this.close()}),t.createEl("small",{text:this.plugin.i18n.t("list.type",{type:e.item.type})+(e.item.position?this.plugin.i18n.t("list.position",{position:e.item.position}):"")})}};tt.ButtonCls="abbreviations-plugin-list-item-button";var Z=tt;var V=require("obsidian");var R=class extends V.Modal{constructor(e,t,i,n){super(e),this.plugin=t,typeof i=="string"?this.selectedText=i:this.selectedAbbr=i,this.onSubmit=n}submitModal(e,t,i){e&&(this.close(),this.onSubmit(e,t,i))}onOpen(){let e="",t="";if(this.selectedAbbr){let{type:s,key:o,title:r}=this.selectedAbbr;this.setTitle(this.plugin.i18n.t("input.editTitle",{type:s})),e=o,t=r}else if(this.setTitle(this.plugin.i18n.t("input.addTitle")),this.selectedText){let s=this.selectedText.replace(/\n/," ").trim();B(s)?e=s:t=s}let{contentEl:i}=this;new V.Setting(i).setName(this.plugin.i18n.t("text.abbrLabel")).addText(s=>{s.setPlaceholder(this.plugin.i18n.t("text.abbrPlaceholder")).setValue(e).onChange(r=>{e=r.trim()});let o=!1;s.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&(o=!0)}),s.inputEl.addEventListener("keyup",r=>{o&&r.key==="Enter"&&(e=s.getValue().trim(),this.submitModal(e,t,"edit"))})}).addText(s=>{s.setPlaceholder(this.plugin.i18n.t("text.tipPlaceholder")).setValue(t).onChange(o=>{t=o.trim()}).inputEl.addEventListener("keyup",o=>{o.key==="Enter"&&(t=s.getValue().trim(),this.submitModal(e,t,"edit"))})});let n=new V.Setting(i);this.selectedAbbr&&n.addButton(s=>{s.setButtonText(this.plugin.i18n.t("button.delete")).setWarning().onClick(()=>{this.submitModal(e,t,"delete")})}),n.addButton(s=>{s.setButtonText(this.plugin.i18n.t("button.submit")).setCta().onClick(()=>{this.submitModal(e,t,"edit")})})}onClose(){let{contentEl:e}=this;e.empty()}};var H=require("obsidian"),it=class extends H.Modal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{contentEl:e}=this;G(this.plugin,e,()=>{this.setTitle(this.plugin.i18n.t("manager.title"))})}onClose(){let{contentEl:e}=this;e.empty()}};function G(a,e,t){e.empty(),t(),a.settings.globalAbbreviations.forEach((i,n)=>{new H.Setting(e).setName(a.i18n.t("text.abbrLabel")).addText(s=>s.setPlaceholder(a.i18n.t("text.abbrPlaceholder")).setValue(i.key).onChange(async o=>{a.settings.globalAbbreviations[n].key=o.trim(),await a.saveSettings()})).addText(s=>s.setPlaceholder(a.i18n.t("text.tipPlaceholder")).setValue(i.title).onChange(async o=>{a.settings.globalAbbreviations[n].title=o.trim(),await a.saveSettings()})).addButton(s=>s.setButtonText(a.i18n.t("button.delete")).setWarning().onClick(async()=>{a.settings.globalAbbreviations.splice(n,1),await a.saveSettings(),G(a,e,t);}))}),new H.Setting(e).addButton(i=>i.setButtonText(a.i18n.t("button.add")).setCta().setTooltip(a.i18n.t("manager.addTip")).onClick(async()=>{a.settings.globalAbbreviations.push({key:"",title:""}),await a.saveSettings(),G(a,e,t);}))}var g=require("obsidian");var Bt=require("obsidian"),nt=class extends Bt.AbstractInputSuggest{constructor(t,i){super(t,i);this.app=t;this.textInputEl=i}getSuggestions(t){let i=this.app.vault.getFiles(),n=t.toLowerCase();return i.map(s=>s.path).filter(s=>s.toLowerCase().includes(n))}renderSuggestion(t,i){i.setText(t)}};var st=class extends g.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=new g.Setting(e).setName(this.plugin.i18n.t("setting.metadataKeyword")).addText(f=>f.setPlaceholder(this.plugin.i18n.t("setting.metadataKeywordPlaceholder")).setValue(this.plugin.settings.metadataKeyword).onChange(async b=>{this.plugin.settings.metadataKeyword=b.trim(),await this.plugin.saveSettings()})),i=createFragment(),n=this.plugin.i18n.getPlaceholderTuple("setting.metadataKeywordDesc");i.append(n[0],createEl("a",{href:"https://help.obsidian.md/Editing+and+formatting/Properties",text:this.plugin.i18n.t("setting.properties")}),n[1]),t.descEl.appendChild(i),new g.Setting(e).setName(this.plugin.i18n.t("setting.markInSourceMode")).setDesc(this.plugin.i18n.t("setting.markInSourceModeDesc")).addToggle(f=>{f.setValue(this.plugin.settings.markInSourceMode).onChange(async b=>{this.plugin.settings.markInSourceMode=b,await this.plugin.saveSettings()})});let s=new g.Setting(e).setName(this.plugin.i18n.t("setting.detectCJK")).addToggle(f=>{f.setValue(this.plugin.settings.detectCJK).onChange(async b=>{this.plugin.settings.detectCJK=b,await this.plugin.saveSettings()})}),o=createFragment(),r=this.plugin.i18n.getPlaceholderTuple("setting.detectCJKDesc");o.append(r[0],createEl("abbr",{text:"CJK",title:"Chinese, Japanese, Korean"}),r[1]),s.descEl.appendChild(o),new g.Setting(e).setName(this.plugin.i18n.t("setting.extraHeading")).setHeading();let d=new g.Setting(e).setName(this.plugin.i18n.t("setting.useMarkdownExtraSyntax")).addToggle(f=>{f.setValue(this.plugin.settings.useMarkdownExtraSyntax).onChange(async b=>{this.plugin.settings.useMarkdownExtraSyntax=b,await this.plugin.saveSettings()})}),l=createFragment(),c=this.plugin.i18n.getPlaceholderTuple("setting.useMarkdownExtraSyntaxDesc");l.append(c[0],createEl("b",{text:"*[W3C]: World Wide Web Consortium"}),c[1]),d.descEl.appendChild(l),new g.Setting(e).setName(this.plugin.i18n.t("setting.useExtraDefinitionDecorator")).setDesc(this.plugin.i18n.t("setting.useExtraDefinitionDecoratorDesc")).addToggle(f=>{f.setValue(this.plugin.settings.useExtraDefinitionDecorator).onChange(async b=>{this.plugin.settings.useExtraDefinitionDecorator=b,await this.plugin.saveSettings()})}),new g.Setting(e).setName(this.plugin.i18n.t("setting.extraDefinitionDecoratorOpacity")).setDesc(this.plugin.i18n.t("setting.extraDefinitionDecoratorOpacityDesc")).addSlider(f=>{f.setLimits(10,100,10).setValue(this.plugin.settings.extraDefinitionDecoratorOpacity).onChange(async b=>{this.plugin.settings.extraDefinitionDecoratorOpacity=this.isOpacityValue(b)?b:20,await this.plugin.saveSettings()}).setDynamicTooltip()}),new g.Setting(e).setName(this.plugin.i18n.t("setting.extraDefinitionDecoratorContent")).setDesc(this.plugin.i18n.t("setting.extraDefinitionDecoratorContentDesc")).addText(f=>{f.setValue(this.plugin.settings.extraDefinitionDecoratorContent).onChange(async b=>{this.plugin.settings.extraDefinitionDecoratorContent=b,await this.plugin.saveSettings()})}),new g.Setting(e).setName(this.plugin.i18n.t("setting.global")).setHeading();let p=new g.Setting(e).setName(this.plugin.i18n.t("setting.globalAbbreviations")).addButton(f=>{f.setButtonText(this.plugin.i18n.t("setting.globalAbbreviationsButton")).onClick(()=>{this.displayGlobalAbbreviations()})}),h=createFragment(),m=this.plugin.i18n.getPlaceholderTuple("setting.globalAbbreviationsDesc");h.append(m[0],createEl("a",{href:"https://help.obsidian.md/Editing+and+formatting/Properties",text:this.plugin.i18n.t("setting.properties")}),m[1]),p.descEl.appendChild(h),new g.Setting(e).setName(this.plugin.i18n.t("setting.globalFile")).setDesc(this.plugin.i18n.t("setting.globalFileDesc")).addText(f=>{f.setValue(this.plugin.settings.globalFile||"").onChange(async I=>{let ot=this.plugin.settings.globalFile!==I;this.plugin.settings.globalFile=I,await this.plugin.saveSettings(ot)});let b=new nt(this.app,f.inputEl);b.onSelect(async I=>{let ot=this.plugin.settings.globalFile!==I;f.setValue(I),this.plugin.settings.globalFile=I,b.close(),await this.plugin.saveSettings(ot)})}),new g.Setting(e).setName(this.plugin.i18n.t("setting.suffixesHeading")).setHeading(),new g.Setting(e).setName(this.plugin.i18n.t("setting.detectAffixes")).setDesc(this.plugin.i18n.t("setting.detectAffixesDesc")).addToggle(f=>{f.setValue(this.plugin.settings.detectAffixes).onChange(async b=>{this.plugin.settings.detectAffixes=b,await this.plugin.saveSettings()})});let x=new g.Setting(e).setName(this.plugin.i18n.t("setting.affixes")).addText(f=>{f.setPlaceholder(this.plugin.i18n.t("setting.affixesPlaceholder")).setValue(this.plugin.settings.affixes).onChange(async b=>{this.plugin.settings.affixes=b.trim(),await this.plugin.saveSettings()})}),u=createFragment(),S=this.plugin.i18n.getPlaceholderTuple("setting.affixesDesc");u.append(S[0],createEl("b",{text:"s, es, less"}),S[1]),x.descEl.appendChild(u)}displayGlobalAbbreviations(){let{containerEl:e}=this;G(this.plugin,e,()=>{new g.Setting(e).setName(this.plugin.i18n.t("setting.globalAbbreviations")).setHeading().addButton(t=>{t.setButtonText(this.plugin.i18n.t("button.back")).onClick(()=>{this.display()})})})}isOpacityValue(e){return e>=10&&e<=100&&e%10===0}};var De={metadataKeyword:"abbr",detectCJK:!1,detectAffixes:!1,affixes:"",markInSourceMode:!1,globalAbbreviations:[],useMarkdownExtraSyntax:!1,useExtraDefinitionDecorator:!1,extraDefinitionDecoratorOpacity:20,extraDefinitionDecoratorContent:"\u2192 ${abbr}",globalFile:""},at=class extends y.Plugin{constructor(){super(...arguments);this.globalFileAbbreviations=[];this.i18n=xt;this.debouncedSaveSettings=(0,y.debounce)(this.rerenderPreviewMarkdown.bind(this),1e3,!0)}async onload(){await this.loadSettings(),this.registerEditorExtension([Lt,Nt,this.createAbbrViewPlugin(this.getPluginData.bind(this))]),this.app.workspace.onLayoutReady(()=>{this.parseGlobalFile()}),this.registerMarkdownPostProcessor(async(i,n)=>{var s;if(this.settings.useMarkdownExtraSyntax){let o=i.findAll(".el-p > p");for(let p of o)p.textContent&&Ct(p.textContent)&&p.classList.add(ht);let r=i.findAll(O);if(r.length===0)return;let d=r.filter(p=>p.nodeName!=="P"||!p.classList.contains(ht));if(d.length===0)return;let l=new E(this.settings.globalAbbreviations,this.settings.metadataKeyword,{extra:!0});l.readAbbreviationsFromCache(n.frontmatter);let c=this.getActiveFile(n.sourcePath);c&&(await this.app.vault.cachedRead(c)).split(`
`).forEach((h,m)=>{l.handler(h,m+1)}),Pt(n,d,n.sourcePath===this.settings.globalFile?l.abbreviations:this.globalFileAbbreviations.concat(l.abbreviations),this.getAffixList(),this.settings.detectCJK)}else{let o=i.findAll(O);if(o.length===0)return;let r=n.frontmatter;if(this.settings.metadataKeyword&&!r&&(i.classList.contains("table-cell-wrapper")||i.classList.contains("markdown-rendered"))){let l=this.getActiveFile(n.sourcePath);l&&(r=(s=this.app.metadataCache.getFileCache(l))==null?void 0:s.frontmatter)}let d=this.getAbbrList(r);_(o,n.sourcePath===this.settings.globalFile?d:this.globalFileAbbreviations.concat(d),this.getAffixList(),this.settings.detectCJK)}}),this.registerEvent(this.app.metadataCache.on("changed",(0,y.debounce)(i=>{var n;this.settings.metadataKeyword&&i&&i.path===((n=this.getActiveFile())==null?void 0:n.path)&&this.rerenderPreviewMarkdown(i)},250,!0))),this.registerEvent(this.app.workspace.on("active-leaf-change",this.handleModeChange.bind(this))),this.registerEvent(this.app.workspace.on("layout-change",this.handleModeChange.bind(this))),this.registerEvent(this.app.vault.on("modify",i=>{i.path===this.settings.globalFile&&this.parseGlobalFile()})),this.registerEvent(this.app.vault.on("delete",i=>{i.path===this.settings.globalFile&&(this.globalFileAbbreviations=[])}));let t=new Y(this,this.abbreviationActionHandler.bind(this));this.registerDomEvent(this.app.workspace.containerEl,"contextmenu",t.readingViewDomHandlers.bind(t)),this.registerEditorExtension(t.editorViewDomHandlers()),this.addCommand({id:"add-abbreviation",name:this.i18n.t("command.add"),checkCallback:i=>this.settings.metadataKeyword?(i||this.showAddMetaAbbreviationModal(),!0):!1}),this.addCommand({id:"copy-with-format",name:this.i18n.t("command.copy"),callback:()=>{this.copyAndFormatContent()}}),this.addCommand({id:"insert-extra-definition",name:this.i18n.t("command.insert"),editorCheckCallback:i=>this.settings.useMarkdownExtraSyntax?(i||this.insertExtraDefinition(),!0):!1}),this.addCommand({id:"list-abbreviations",name:this.i18n.t("command.list"),callback:()=>{this.showAbbreviationListModal()}}),this.addCommand({id:"manage-global-abbreviations",name:this.i18n.t("command.manage"),callback:()=>{this.showManageAbbreviationsModal()}}),this.addRibbonIcon("text-search",this.i18n.t("command.list"),()=>{this.showAbbreviationListModal()}),this.addSettingTab(new st(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},De,await this.loadData())}async saveSettings(t=!1){await this.saveData(this.settings),t&&await this.parseGlobalFile(),this.debouncedSaveSettings()}createAbbrViewPlugin(t){return $t.ViewPlugin.fromClass(class extends Q{constructor(i){super(i,t)}})}handleModeChange(){let t=this.app.workspace.getActiveViewOfType(y.MarkdownView);if(t){let i=t.getMode()==="source",n=t.editor.cm;n&&n.dispatch({effects:X.of(i)})}}getAbbrList(t){let i=this.settings.globalAbbreviations.map(({key:s,title:o})=>({key:s,title:o,type:"global"})).filter(s=>s.key),n=P(t,this.settings.metadataKeyword);return i.push(...n),i}rerenderPreviewMarkdown(t){let i=this.app.workspace.getActiveViewOfType(y.MarkdownView);i&&(!t||t===i.file)&&i.previewMode.rerender(!0)}async getPluginData(){var o;let{metadataKeyword:t,...i}=this.settings,n=this.getActiveFile(),s={metadataKeyword:t,frontmatterCache:void 0,suffixes:this.getAffixList(),globalFileAbbreviations:(n==null?void 0:n.path)===this.settings.globalFile?[]:this.globalFileAbbreviations,...i};return t&&n&&(s.frontmatterCache=(o=this.app.metadataCache.getFileCache(n))==null?void 0:o.frontmatter),s}getAffixList(){return this.settings.detectAffixes?Dt(this.settings.affixes):void 0}getActiveFile(t){return t?this.app.vault.getFileByPath(t):this.app.workspace.getActiveFile()}async copyAndFormatContent(){let t=this.getActiveFile();if(t){let i=await this.app.vault.cachedRead(t),n=Ft(i,this.settings.globalAbbreviations,this.settings.metadataKeyword,this.settings.useMarkdownExtraSyntax,this.getAffixList(),this.settings.detectCJK);this.copyContent(n)}}insertExtraDefinition(){var i;let t=(i=this.app.workspace.activeEditor)==null?void 0:i.editor;if(t){let n=t.getSelection(),s=n?`*[${n}]: `:"*[]: ",o=t.getCursor();n?t.replaceSelection(s):t.replaceRange(s,o),t.setCursor({line:o.line,ch:o.ch+(n?n.length+5:2)})}}showAddMetaAbbreviationModal(){var i;let t=(i=this.app.workspace.activeEditor)==null?void 0:i.editor;if(t){let n=t.getSelection();new R(this.app,this,n,this.addAbbreviationToFrontmatter.bind(this)).open()}}async showAbbreviationListModal(){var s,o;let t=[],i="",n=this.getActiveFile();if(n){let r=(s=this.app.metadataCache.getFileCache(n))==null?void 0:s.frontmatter;if(this.settings.useMarkdownExtraSyntax){let l=new E(this.settings.globalAbbreviations,this.settings.metadataKeyword,{extra:!0});l.readAbbreviationsFromCache(r),(await this.app.vault.cachedRead(n)).split(`
`).forEach((p,h)=>{l.handler(p,h+1)}),t=l.abbreviations}else t=this.getAbbrList(r);let d=(o=this.app.workspace.activeEditor)==null?void 0:o.editor;d&&(i=d.getSelection()),new Z(this.app,this,n.path===this.settings.globalFile?t:this.globalFileAbbreviations.concat(t),i,this.abbreviationActionHandler.bind(this)).open()}}showManageAbbreviationsModal(){new it(this.app,this).open()}addAbbreviationToFrontmatter(t,i){try{this.strictCheckAbbreviationFormat(t);let n=this.strictGetMetadataKeyword(),s=this.strictGetActiveFile();this.app.fileManager.processFrontMatter(s,o=>{if(this.checkFrontmatter(o)){let r=`${t}: ${i}`;Array.isArray(o[n])?o[n].push(r):o[n]=[r],this.sendNotification(this.i18n.t("notification.metadataAdded",{abbr:t}))}})}catch(n){this.sendErrorNotification(n)}}modifyAbbreviationInFrontmatter(t,i,n){try{this.strictCheckAbbreviationFormat(i);let s=this.strictGetMetadataKeyword(),o=this.strictGetActiveFile();this.app.fileManager.processFrontMatter(o,r=>{if(this.checkFrontmatter(r)){let d=bt(t,r,s);if(d>-1){let l=`${i}: ${n}`;r[s][d]=l}else this.sendNotFoundWarn()}})}catch(s){this.sendErrorNotification(s)}}deleteAbbreviationFromFrontmatter(t){try{let i=this.strictGetMetadataKeyword(),n=this.strictGetActiveFile();this.app.fileManager.processFrontMatter(n,s=>{if(this.checkFrontmatter(s)){let o=bt(t,s,i);o>-1&&(s[i].splice(o,1),this.sendNotification(this.i18n.t("notification.metadataDeleted",{abbr:t.key})))}})}catch(i){this.sendErrorNotification(i)}}modifyAbbreviationInGlobal(t,i,n){if(!B(i)){this.sendFormatWarn();return}let s=ut(t,this.settings.globalAbbreviations);s>-1?(this.settings.globalAbbreviations[s]={key:i,title:n},this.saveSettings()):this.sendNotFoundWarn()}deleteAbbreviationFromGlobal(t){let i=ut(t,this.settings.globalAbbreviations);i>-1&&(this.settings.globalAbbreviations.splice(i,1),this.saveSettings(),this.sendNotification(this.i18n.t("notification.globalDeleted",{abbr:t.key})))}async abbreviationActionHandler(t,i){var n,s;if(i==="edit")if(t.type==="extra"){let o=(n=this.app.workspace.activeEditor)==null?void 0:n.editor;if(o){let r=this.app.workspace.getActiveViewOfType(y.MarkdownView);if(r){let l=r.getMode()==="preview";l&&this.app.commands.executeCommandById("markdown:toggle-preview")}let d=t.position-1;o.setCursor(d>=0?d:0)}}else if(t.type==="global-file"){let o=this.app.vault.getFileByPath(this.settings.globalFile||"");if(!o)this.sendNotification(this.i18n.t("notification.fileNotExistError"));else if(await this.app.workspace.getLeaf("tab").openFile(o,{active:!0}),t.position&&t.position>0){let d=(s=this.app.workspace.activeEditor)==null?void 0:s.editor;if(d){let l=this.app.workspace.getActiveViewOfType(y.MarkdownView);if(l){let p=l.getMode()==="preview";p&&this.app.commands.executeCommandById("markdown:toggle-preview")}let c=t.position-1;d.setCursor(c>=0?c:0)}}}else new R(this.app,this,t,(o,r,d)=>{d==="delete"?t.type==="metadata"?this.deleteAbbreviationFromFrontmatter(t):t.type==="global"&&this.deleteAbbreviationFromGlobal(t):d==="edit"&&(t.type==="metadata"?this.modifyAbbreviationInFrontmatter(t,o,r):t.type==="global"&&this.modifyAbbreviationInGlobal(t,o,r))}).open();else if(i==="global")this.settings.globalAbbreviations.push({key:t.key,title:t.title}),await this.saveSettings(),this.sendNotification(this.i18n.t("notification.globalAdded",{abbr:t.key}));else if(i.includes("copy")){let o="";switch(i){case"copy-text":o=t.key;break;case"copy-title":o=t.title;break;case"copy-metadata":o=`${t.key}: ${t.title}`;break;case"copy-extra":o=`*[${t.key}]: ${t.title}`;break;case"copy-html":o=`<abbr title="${W(t.title)}">${W(t.key)}</abbr>`;break}o?this.copyContent(o):this.sendNotification(this.i18n.t("notification.copyWarn"))}}async parseGlobalFile(){var n;if(!this.settings.globalFile){this.globalFileAbbreviations=[];return}let t=this.app.vault.getFileByPath(this.settings.globalFile);if(!t){this.globalFileAbbreviations=[];return}let i=(n=this.app.metadataCache.getFileCache(t))==null?void 0:n.frontmatter;if(this.settings.useMarkdownExtraSyntax){let s=new E([],this.settings.metadataKeyword,{extra:!0});s.readAbbreviationsFromCache(i),(await this.app.vault.cachedRead(t)).split(`
`).forEach((r,d)=>{s.handler(r,d+1)}),this.globalFileAbbreviations=s.abbreviations.map(r=>({key:r.key,title:r.title,position:r.position,type:"global-file"}))}else this.globalFileAbbreviations=P(i).map(s=>({key:s.key,title:s.title,position:s.position,type:"global-file"}))}async copyContent(t){try{await navigator.clipboard.writeText(t),this.sendNotification(this.i18n.t("notification.copied"))}catch(i){this.sendNotification(this.i18n.t("notification.copyError"))}}checkFrontmatter(t){return typeof t=="object"&&t?!0:(this.sendNotification(this.i18n.t("notification.unexpectedError")),!1)}strictCheckAbbreviationFormat(t){if(!B(t))throw new Error(this.i18n.t("notification.formatWarn"))}strictGetMetadataKeyword(){let t=this.settings.metadataKeyword;if(t)return t;throw new Error(this.i18n.t("notification.metadataError"))}strictGetActiveFile(){let t=this.getActiveFile();if(t)return t;throw new Error(this.i18n.t("notification.fileError"))}sendErrorNotification(t){t instanceof Error&&this.sendNotification(t.message)}sendFormatWarn(){this.sendNotification(this.i18n.t("notification.formatWarn"))}sendNotFoundWarn(){this.sendNotification(this.i18n.t("notification.notFoundWarn"))}sendNotification(t){new y.Notice(t)}};var Me=at;
//! `-` and `&` not considered a special character
//! empty line
//! Rerender
//! Delay trigger rerender
//! Toggle reading view to editing view.

/* nosourcemap */